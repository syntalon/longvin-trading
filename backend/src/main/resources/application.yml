# Default configuration (used when no profile is specified)
# This acts as the production configuration
spring:
  application:
    name: LongvinTradingBackend
  datasource:
    url: jdbc:postgresql://dev-chia.postgres.database.azure.com:5432/dev_svc_longvin?sslmode=require&connectTimeout=60&socketTimeout=60&loginTimeout=30&currentSchema=svc_longvin
    driver-class-name: org.postgresql.Driver
    username: svc_longvin_user
    password: syntalon@123
    hikari:
      connection-timeout: 60000
      maximum-pool-size: 5
      minimum-idle: 1
      idle-timeout: 300000
      max-lifetime: 1200000
      leak-detection-threshold: 60000
      schema: svc_longvin
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations, validate schema matches entities
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        default_schema: svc_longvin
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    schemas: svc_longvin
    default-schema: svc_longvin
    # PostgreSQL 17 support
    database-type: postgresql

server:
  port: 8081

logging:
  file:
    name: logs/application.log
    max-size: 10MB
    max-history: 30
  level:
    quickfix: DEBUG
    quickfix.mina: DEBUG
    com.longvin.trading.fix: DEBUG

trading:
  initiator:
    non-trading-resume-hour: 6
  fix:
    enabled: true
    config-path: classpath:fix/das-mirror-trading.cfg
    primary-session: OS111
    drop-copy-session-sender-comp-id: OS111
    drop-copy-session-target-comp-id: DAST
    primary-account: PRIMARY_ACCOUNT
    shadow-sessions: SHADOW1,SHADOW2
    shadow-accounts:
      SHADOW1: SHADOW_ACCOUNT_1
      SHADOW2: SHADOW_ACCOUNT_2
    shadow-account-policies:
      SHADOW1:
        ratio: 5.0
        replenish-window: PT2M
        holding-window: PT3M
        partial-cancel-window: PT30S
      SHADOW2:
        ratio: 1.0
        replenish-window: PT2M
        holding-window: PT2M
        partial-cancel-window: PT20S
    cl-ord-id-prefix: MIRROR-
---
# Production profile configuration
# This is the default profile for production use
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: jdbc:postgresql://dev-chia.postgres.database.azure.com:5432/dev_svc_longvin?sslmode=require&connectTimeout=60&socketTimeout=60&loginTimeout=30&currentSchema=svc_longvin
    driver-class-name: org.postgresql.Driver
    username: svc_longvin_user
    password: syntalon@123
    hikari:
      connection-timeout: 60000
      maximum-pool-size: 5
      minimum-idle: 1
      idle-timeout: 300000
      max-lifetime: 1200000
      leak-detection-threshold: 60000
      schema: svc_longvin
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        default_schema: svc_longvin
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    schemas: svc_longvin
    default-schema: svc_longvin
    database-type: postgresql
    # Note: Schema must be created manually by admin using SETUP_SCHEMA.sql
    # The migration user (svc_longvin_user) doesn't have permission to create schemas
    create-schemas: false

trading:
  fix:
    # Production FIX config (explicit, though already default)
    config-path: classpath:fix/das-mirror-trading.cfg

logging:
  level:
    com.longvin.trading: INFO
    quickfix: INFO
    quickfix.mina: WARN

---
# Test profile configuration
# Use this profile for testing with the simulator
# Run with: --spring.profiles.active=test
spring:
  config:
    activate:
      on-profile: simulator
  datasource:
    url: jdbc:h2:mem:tradingdb-test
    driver-class-name: org.h2.Driver
    username: sa
    password:
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

trading:
  initiator:
    non-trading-resume-hour: 6
  fix:
    enabled: true
    # Override config to use test configuration pointing to simulator
    config-path: classpath:fix/das-mirror-trading-simulator.cfg
    primary-session: OPAL
    drop-copy-session-sender-comp-id: OS111
    drop-copy-session-target-comp-id: DAST
    primary-account: PRIMARY_ACCOUNT
    shadow-sessions: SHADOW1,SHADOW2
    shadow-accounts:
      SHADOW1: SHADOW_ACCOUNT_1
      SHADOW2: SHADOW_ACCOUNT_2
    shadow-account-policies:
      SHADOW1:
        ratio: 5.0
        replenish-window: PT2M
        holding-window: PT3M
        partial-cancel-window: PT30S
      SHADOW2:
        ratio: 1.0
        replenish-window: PT2M
        holding-window: PT2M
        partial-cancel-window: PT20S
    cl-ord-id-prefix: MIRROR-
---
# Dev profile configuration
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    url: jdbc:h2:mem:tradingdb-dev
    driver-class-name: org.h2.Driver
    username: sa
    password:
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

trading:
  fix:
    # Dev FIX config pointing to DAS Trader dev environment
    config-path: classpath:fix/das-mirror-trading-dev.cfg
