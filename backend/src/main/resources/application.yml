# Default configuration (used when no profile is specified)
# This acts as the production configuration
spring:
  application:
    name: LongvinTradingBackend
  datasource:
    url: jdbc:h2:mem:tradingdb
    driver-class-name: org.h2.Driver
    username: sa
    password:
    hikari:
      # Connection pool settings
      minimum-idle: 2
      maximum-pool-size: 10
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      # Housekeeper runs every 30 seconds by default
      # Increase the threshold for thread starvation detection to reduce false positives
      # This is a HikariCP internal setting - we can't directly configure it,
      # but ensuring adequate thread pool sizes helps
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations, validate schema matches entities
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0

server:
  port: 8081

logging:
  file:
    name: logs/application.log
    max-size: 10MB
    max-history: 30
  level:
    quickfix: DEBUG
    quickfix.mina: DEBUG
    com.longvin.trading.fix: DEBUG

trading:
  initiator:
    non-trading-resume-hour: 6
  fix:
    enabled: true
    config-path: classpath:fix/das-mirror-trading.cfg
    primary-session: OS111
    drop-copy-session-sender-comp-id: OS111
    drop-copy-session-target-comp-id: DAST
    primary-account: PRIMARY_ACCOUNT
    shadow-sessions: SHADOW1,SHADOW2
    shadow-accounts:
      SHADOW1: SHADOW_ACCOUNT_1
      SHADOW2: SHADOW_ACCOUNT_2
    cl-ord-id-prefix: MIRROR-
---
# Production profile configuration
# This is the default profile for production use
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: jdbc:h2:mem:tradingdb-prod
    driver-class-name: org.h2.Driver
    username: sa
    password:
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

trading:
  fix:
    # Production FIX config (explicit, though already default)
    config-path: classpath:fix/das-mirror-trading.cfg

logging:
  level:
    com.longvin.trading: INFO
    quickfix: INFO
    quickfix.mina: WARN

---
# Test profile configuration
# Use this profile for testing with the simulator
# Run with: --spring.profiles.active=test
spring:
  config:
    activate:
      on-profile: simulator
  datasource:
    url: jdbc:h2:mem:tradingdb-test
    driver-class-name: org.h2.Driver
    username: sa
    password:
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

trading:
  fix:
    # Override config to use test configuration pointing to simulator
    config-path: classpath:fix/das-mirror-trading-test.cfg

logging:
  level:
    com.longvin.trading: DEBUG

---
# Dev profile configuration
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    url: jdbc:h2:mem:tradingdb-dev
    driver-class-name: org.h2.Driver
    username: sa
    password:
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

trading:
  fix:
    # Dev FIX config pointing to DAS Trader dev environment
    config-path: classpath:fix/das-mirror-trading-dev.cfg

logging:
  level:
    com.longvin.trading: DEBUG
    quickfix: DEBUG
    quickfix.mina: DEBUG
    quickfix.mina.initiator: TRACE
    quickfix.mina.acceptor: DEBUG
    com.longvin.trading.processor: DEBUG
    org.apache.mina: DEBUG
